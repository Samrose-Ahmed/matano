<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-post-page plugin-blog plugin-id-blog-archive">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">How we build a fully regional cloud architecture on AWS | Matano</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://www.matano.dev/blog-archive/2022/03/09/regional-cloud-architecture"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_tag" content="default"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:docusaurus_tag" content="default"><meta data-rh="true" property="og:title" content="How we build a fully regional cloud architecture on AWS | Matano"><meta data-rh="true" name="description" content="How we&#x27;ve built a fully regional cloud infrastructure on AWS at Apptrail."><meta data-rh="true" property="og:description" content="How we&#x27;ve built a fully regional cloud infrastructure on AWS at Apptrail."><meta data-rh="true" name="keywords" content="software,cloud,AWS,regional"><meta data-rh="true" property="og:type" content="article"><meta data-rh="true" property="article:published_time" content="2022-03-09T00:00:00.000Z"><meta data-rh="true" property="article:author" content="https://www.matano.dev"><meta data-rh="true" property="article:tag" content="engineering"><link data-rh="true" rel="icon" href="/img/favicon.svg"><link data-rh="true" rel="canonical" href="https://www.matano.dev/blog-archive/2022/03/09/regional-cloud-architecture"><link data-rh="true" rel="alternate" href="https://www.matano.dev/blog-archive/2022/03/09/regional-cloud-architecture" hreflang="en"><link data-rh="true" rel="alternate" href="https://www.matano.dev/blog-archive/2022/03/09/regional-cloud-architecture" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://VHU6P09Z0T-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Matano RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Matano Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-Z8SY9N8YJR"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-Z8SY9N8YJR",{})</script>


<link rel="search" type="application/opensearchdescription+xml" title="Matano" href="/opensearch.xml">


<link rel="alternate" type="application/rss+xml" href="/blog-archive/rss.xml" title="Matano RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog-archive/atom.xml" title="Matano Atom Feed">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Lexend:wght@400;500;600&display=swap"><link rel="stylesheet" href="/assets/css/styles.8d30dc57.css">
<link rel="preload" href="/assets/js/runtime~main.09143151.js" as="script">
<link rel="preload" href="/assets/js/main.4652622e.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" style="background-color:var(--ifm-color-primary-light);color:#ffffff" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY"><div id="mtn-announcement" class="flex items-center justify-center" style="gap: 7px;">
          <svg height="16px" width="16px" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3 .3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5 .3-6.2 2.3zm44.2-1.7c-2.9 .7-4.9 2.6-4.6 4.9 .3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3 .7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3 .3 2.9 2.3 3.9 1.6 1 3.6 .7 4.3-.7 .7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3 .7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3 .7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg>
          <span>Star us <a target="_blank" rel="noopener noreferrer" href="https://github.com/matanolabs/matano"> on GitHub</a></span>
        </div></div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_m1mJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/matano-logo/vector/default-monochrome-black.svg" alt="Matano" class="themedImage_ToTc themedImage--light_HNdA" style="height:30px"><img src="/matano-logo/vector/default-monochrome-white.svg" alt="Matano" class="themedImage_ToTc themedImage--dark_i4oU" style="height:30px"></div></a><a class="navbar__item navbar__link" href="/docs">Docs</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="navbar__items navbar__items--right"><iframe class="ghButton_pHgp" src="https://ghbtns.com/github-btn.html?user=matanolabs&amp;repo=matano&amp;type=star&amp;count=true&amp;size=large" frameborder="0" scrolling="0" width="150" height="30" title="GitHub"></iframe><a href="https://github.com/matanolabs/matano" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a aria-current="page" class="sidebarItemLink_mo7H sidebarItemLinkActive_I1ZP" href="/blog-archive/2022/03/09/regional-cloud-architecture">How we build a fully regional cloud architecture on AWS</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog-archive/2022/03/07/internal-vs-customer-facing-audit-logs">The difference between internal and customer facing audit logs</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog-archive/2022/02/14/s3-post-policy">S3 POST Policy - The hidden S3 feature you haven&#x27;t heard of</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/blog-archive/2022/02/05/what-makes-a-good-audit-trail">What makes a good audit trail?</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="title_f1Hy" itemprop="headline">How we build a fully regional cloud architecture on AWS</h1><div class="container_mt6G margin-vert--md"><time datetime="2022-03-09T00:00:00.000Z" itemprop="datePublished">March 9, 2022</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://www.matano.dev" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/Samrose-Ahmed.png" alt="Samrose Ahmed"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://www.matano.dev" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">Samrose Ahmed</span></a></div></div></div></div></div></header><div id="post-content" class="markdown" itemprop="articleBody"><p>At least for me, building on the cloud gives often gives me unexpected joy. To think that I can deploy servers in Bahrain or Japan from my couch is still something I get excited about!</p><p>At Apptrail, we run completely on the cloud, specifically AWS, and one of the main reasons is how easy it is to launch services in new geographical regions. We deploy our services to independent cloud regions and provide our customers with regional endpoints (e.g. <code>events.us-west-2.apptrail.com</code>).</p><p>Here are some of our learnings from building a fully regional service on AWS.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="what-are-cloud-regions">What are cloud regions?<a class="hash-link" href="#what-are-cloud-regions" title="Direct link to heading">​</a></h2><p>Cloud providers have a concept of regions for their cloud. These are isolated geographical regions where their physical infrastructure is hosted and where they offer cloud services. For example, at the time of this article, AWS offers 26 different cloud regions. Software applications built on the cloud can leverage cloud regions to also build a concept of regions in their applications to improve their services.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="cellular-architecture">Cellular architecture<a class="hash-link" href="#cellular-architecture" title="Direct link to heading">​</a></h3><p>To understand regionality, it&#x27;s good to understand <em>cellular architecture</em>. Cellular (or cell-based) architecture is a way of separating systems into isolated <em>cells</em> to reduce the blast radius from something going wrong. The idea is that a failure shouldn&#x27;t ever cross cells, and so cellularization is a way of creating those independent partitions. The actual method of choosing a cell can be anything, from random based on ID to logical like geographical region. You can also have nested cells for further isolation (e.g. <em>Large volume customers in US West region</em> could be a particular cell). AWS Availability zones, for example, are also sub-regional cells. All in all, cellularization is a very powerful way of designing available systems, you can <a href="https://www.youtube.com/watch?v=swQbA4zub20" target="_blank" rel="noopener noreferrer">learn more about it here</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="why-regions-exist">Why regions exist<a class="hash-link" href="#why-regions-exist" title="Direct link to heading">​</a></h3><p>Regions, then, are just cells that are based on geographical region. Regions serve several purposes. From an availability and reliability perspective, regions are at the center of a cloud&#x27;s reliability strategy. In a cellular architecture, regions serve as the first and most principal cells. They ensure that there is a logical containment of resources that are isolated from others. This helps prevent widespread outages.</p><p>Regions do refer to actual geographic regions, so this is also an important part of why they exist. One benefit of this is latency. Providing a way for customers to ensure that their workloads run in a particular region helps them with running workloads close to their customers.</p><p>Another important usecase is compliance and data sovereignty. Many countries are passing legislation requiring user data and other sensitive data to be physically stored in locations under their jurisdiction. Cloud regions are a way to ensure compliance with such regulations.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="multi-region-architectures">Multi region architectures<a class="hash-link" href="#multi-region-architectures" title="Direct link to heading">​</a></h2><p>Because cloud providers do the hard work of making sure all their services are available in isolated regions, one benefit customers get is being able to run multi region workloads. Multi region architecture is a way to get another layer of reliability beyond multi availability zone. You can, for example, run a load balanced service across multiple regions using Route 53 for latency based routing and health check based failover. One can also use regions for data preservation and backup, e.g. with Amazon S3. Region wide outages are pretty rare at AWS so active multi region for services is likely overkill (as it may also come with downsides like cross region data transfer), but everyone has their availability requirements and multi region architectures are a powerful tool to leverage for increased availability.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="regionalized-architectures">Regionalized architectures<a class="hash-link" href="#regionalized-architectures" title="Direct link to heading">​</a></h2><p>A regionalized architecture is one where the regionality is part of the interface of the service. For example, in regional architectures, one has dedicated regional endpoints that clients use for each supported region. Each regional service in a regional architecture should be independent of other instances running in other regions.</p><p>As an example, say we have an image processing API. Our clients use this API to upload, process, and retrieve videos. To regionalize this API, we can deploy the API to multiple regions and offer endpoints like <code>region1.videoapi.example.com</code> and <code>region2.videoapi.example.com</code> for our clients to use.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="difference-between-multi-region-and-regionalized-architectures">Difference between multi region and regionalized architectures<a class="hash-link" href="#difference-between-multi-region-and-regionalized-architectures" title="Direct link to heading">​</a></h4><div class="cntr"><p><img loading="lazy" src="/assets/images/regional-diagram-ef9b5ea0c5dec022647f24f931252019.png" width="1168" height="461" class="img_ev3q"></p><p><em>Comparison between regional (left) and multi region architectures</em></p></div><p>The key difference between multi region and regionalized architectures is that in regional architectures, the region is part of the contract of the service, whereas in multi region architectures it is solely part of the implementation. In a multi region architecture, regions are used as cells for increased availability or as a failover. There is no guarantee that a specific customer&#x27;s requests will run in a specific region. Rather, the customer doesn&#x27;t even have to know about the concept of region vis-à-vis the service. In a regional architecture, however, the region is part of the public API, and customers choose or are informed of the region they are associated with.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="choosing-regions-for-a-regional-architecture">Choosing regions for a regional architecture<a class="hash-link" href="#choosing-regions-for-a-regional-architecture" title="Direct link to heading">​</a></h3><p>When building a regionalized architecture, one needs to pick a list of geographical regions to support and a methodology to assign them. You&#x27;re likely deployed on a cloud, so a simple decision is to choose your regions to correspond to cloud regions. This is <a href="https://apptrail.com/docs/applications/guide/regions" target="_blank" rel="noopener noreferrer">what we do at Apptrail</a>, for example. One can rename them, or just use the same names, which is what we do at Apptrail ourselves.</p><p>However, a one-to-one mapping is not necessary. You can also come up with regions that correspond to multiple cloud regions. For example, a region structure could look as follows:</p><div class="cntr"><table><thead><tr><th align="center">Region</th><th align="center">AWS Region(s)</th></tr></thead><tbody><tr><td align="center">us</td><td align="center">us-east-1, us-west-2, us-east-2</td></tr><tr><td align="center">eu</td><td align="center">eu-west-1, eu-west-2</td></tr><tr><td align="center">jp</td><td align="center">ap-northeast-1, ap-northeast-2</td></tr><tr><td align="center">in</td><td align="center">ap-south-1, ap-south-2</td></tr></tbody></table><p><em>Regionalization scheme using multi region cells</em></p></div><p>Such a scheme gives one some benefit of each application region consisting of multiple cloud regions, which can improve availability.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="when-to-use-a-regional-architecture">When to use a regional architecture<a class="hash-link" href="#when-to-use-a-regional-architecture" title="Direct link to heading">​</a></h2><p>Most services likely don&#x27;t need to be fully regionalized. Unlike multi-regionality, which is solely a technical engineering decision, choosing to regionalize your public APIs or services is more so a product decision. It should generally serve some need or purpose for your customer. We observe common usecases:</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="data-residency-requirements">Data residency requirements<a class="hash-link" href="#data-residency-requirements" title="Direct link to heading">​</a></h4><p>Regionalization of your services is a way of allowing your customers to ensure their data is stored and processed in a specific region. This is often requested due to regulatory reasons.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="latency">Latency<a class="hash-link" href="#latency" title="Direct link to heading">​</a></h4><p>For other applications, minimizing client latency is highly important. Keeping requests in the region closest to a customer is a way to achieve this. However, as keeping requests in region is not inherently a strict requirement, complete regionalization may or may not be the correct approach here, as a single endpoint with latency based routing may also fulfill the requirements. The desired experience of the customer is important to consider here (e.g. do you want your customer to have to think of regions?).</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="choosing-components-to-regionalize">Choosing components to regionalize<a class="hash-link" href="#choosing-components-to-regionalize" title="Direct link to heading">​</a></h2><p>When evaluating a regional architecture, a natural question is what components to regionalize. Specifically, which services to have a publicly regional interface for. There are several considerations here, and the answer goes back to why one is using a regional architecture in the first place. A useful heuristic we use is one between <em>control planes</em> and <em>data planes</em>. Generally, control plane services shouldn&#x27;t be regional, but dataplane services can be. To understand why, we may consider the common actions we do in the control plane: e.g. billing, user management, or other global configuration. These often have single region dependencies and are relatively infrequent. For us, it&#x27;s neither important nor desirable to have these be regionalized. On the other hand, our data plane processes that process and store important data are regionalized.</p><p>Note that while this is a general guideline that we ourselves have found useful, it&#x27;s in no way prescriptive. There are many cases where one may make the control plane regionalized as well. In general, the reason for regionalization should be central to this decision. One should consider how regionalizing a service will help or prevent them from achieving that goal.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="how-we-deploy-to-many-regions">How we deploy to many regions<a class="hash-link" href="#how-we-deploy-to-many-regions" title="Direct link to heading">​</a></h2><p>Infrastructure and deployment automation is key to being able to maintain consistency, reliability, and understandability while deploying many services across different regions. Thankfully, infrastructure as code solutions, particularly the AWS CDK, make this much easier.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="staged-deployment-using-waves">Staged deployment using Waves<a class="hash-link" href="#staged-deployment-using-waves" title="Direct link to heading">​</a></h3><p>We use a concept of <em>waves</em> when deploying software at Apptrail. Going back to cellular architecture, a wave is essentially a set of cells to deploy to concurrently. For example, currently, our waves are:</p><div class="cntr"><table><thead><tr><th align="center">Wave</th><th align="center">Apptrail Regions</th></tr></thead><tbody><tr><td align="center">Wave 1</td><td align="center">ap-south-1</td></tr><tr><td align="center">Wave 2</td><td align="center">eu-west-1</td></tr><tr><td align="center">Wave 3</td><td align="center">us-west-2, us-east-1</td></tr></tbody></table><p><em>Our current waves at Apptrail</em></p></div><p>Deploying to one wave at a time ensures that faulty changes don&#x27;t cause global outages. Combined with bake times (adding wait times between waves to monitor for degradation) and automated rollbacks, waves can help ensure that you don&#x27;t have catastrophic failures. We&#x27;ve found them to be very useful for staging our changes. You can <a href="https://aws.amazon.com/builders-library/automating-safe-hands-off-deployments/" target="_blank" rel="noopener noreferrer">learn more about waves here</a>.</p><h3 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="infrastructure-as-code---cdk">Infrastructure as Code - CDK<a class="hash-link" href="#infrastructure-as-code---cdk" title="Direct link to heading">​</a></h3><p>Completely automating your infrastructure is essential when deploying to many regions since one is duplicating one&#x27;s entire application and services each time they deploy to a new region. We use the AWS CDK to help us do this. CDK is a wrapper around CloudFormation that lets you write your infrastructure as real code (e.g. we use Typescript). It makes building reusable abstractions (called <em>constructs</em>) as easy as writing a class or a function (<a href="https://docs.aws.amazon.com/cdk/v2/guide/home.html" target="_blank" rel="noopener noreferrer">Learn more about it here</a>, we think it&#x27;s one of the coolest things AWS offers!).</p><p>The CDK also comes with useful high level abstractions out of the box, so you don&#x27;t have to reinvent the wheel.</p><div class="cntr"><p><img loading="lazy" src="/assets/images/apptrail-waves-ffbffb671a220d613cf67fdf09505129.png" width="563" height="418" class="img_ev3q"></p><p><em>A pipeline deploying one of our regional services to one of our waves</em></p></div><p>For example, we use <a href="https://aws.amazon.com/blogs/developer/cdk-pipelines-continuous-delivery-for-aws-cdk-applications" target="_blank" rel="noopener noreferrer">CDK Pipelines</a> for deploying all of our infrastructure at Apptrail. In CDK Pipelines, stages and <em>waves</em> are supported natively so you can easily deploy cellular applications. At Apptrail, we&#x27;ve developed a standard <em>Pipeline</em> construct that sets up our standard waves and makes creating a regionalized service conforming to Apptrail regions and waves very simple.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="other-considerations-around-regional-architectures">Other considerations around regional architectures<a class="hash-link" href="#other-considerations-around-regional-architectures" title="Direct link to heading">​</a></h2><p>Here are some other things we&#x27;ve learned building regional applications on AWS.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="use-separate-aws-accounts-per-region">Use separate AWS accounts per region<a class="hash-link" href="#use-separate-aws-accounts-per-region" title="Direct link to heading">​</a></h4><p>This is general AWS best practice but reinforces thinking of each instance of a service deployed in a region as separate with clearly delineated blast radiuses.</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="managing-cost">Managing cost<a class="hash-link" href="#managing-cost" title="Direct link to heading">​</a></h4><p>Regionalization inherently comes with some additional cost. However, when an application is architected correctly, the additional cost due to regionalization should mainly be a fixed cost per region, which is generally negligible at scale. Regionalized services shouldn&#x27;t generally have excessive have cross-region data transfer (databases and other global data is often the exception, but this should be low cost).</p><h4 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="global-data">Global data<a class="hash-link" href="#global-data" title="Direct link to heading">​</a></h4><p>A common consideration when evaluating a regionalized or multi region architecture is what to do with global data. There&#x27;s no one answer here. Keeping in mind our earlier discussion on choosing components to regionalize and data planes &amp; control planes, there are several ways we could deal with this. For example, we could keep global data in one control plane region, and our regionalized data plane services can depend on this control plane. This is what we use ourselves at Apptrail. However, this may or may not be acceptable. If latency is the primary motivation for regionalization, then this is less than ideal. There are several ways to deal with this, including DynamoDB Global Tables and database replication, that are beyond the scope of this article (see this <a href="https://www.youtube.com/watch?v=2e29I3dA8o4" target="_blank" rel="noopener noreferrer">video</a> for some more information). On the other hand, if the main reason for regionalization is data residency, and our control plane only stores non-sensitive configuration, then this is a more fitting approach.</p><h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="conclusion">Conclusion<a class="hash-link" href="#conclusion" title="Direct link to heading">​</a></h2><p>As it gets easier and easier to deploy to the cloud, and with increased concern about data sovereignty, regional architectures are becoming more common. This gave you an overview of how we easily maintain our regional services on AWS at Apptrail. You might not need regionalization for your next project, but I hope this was helpful and informative.</p><p><em>What do you think of regionalization, do you use it in your applications? Feel free to reply.</em></p></div><footer class="row docusaurus-mt-lg blogPostFooterDetailsFull_mRVl"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/blog-archive/tags/engineering">engineering</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><a class="pagination-nav__link pagination-nav__link--next" href="/blog-archive/2022/03/07/internal-vs-customer-facing-audit-logs"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">The difference between internal and customer facing audit logs</div></a></nav></main><div class="col col--2"><div class="tableOfContents_bqdL thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-are-cloud-regions" class="table-of-contents__link toc-highlight">What are cloud regions?</a><ul><li><a href="#cellular-architecture" class="table-of-contents__link toc-highlight">Cellular architecture</a></li><li><a href="#why-regions-exist" class="table-of-contents__link toc-highlight">Why regions exist</a></li></ul></li><li><a href="#multi-region-architectures" class="table-of-contents__link toc-highlight">Multi region architectures</a></li><li><a href="#regionalized-architectures" class="table-of-contents__link toc-highlight">Regionalized architectures</a><ul><li><a href="#choosing-regions-for-a-regional-architecture" class="table-of-contents__link toc-highlight">Choosing regions for a regional architecture</a></li></ul></li><li><a href="#when-to-use-a-regional-architecture" class="table-of-contents__link toc-highlight">When to use a regional architecture</a></li><li><a href="#choosing-components-to-regionalize" class="table-of-contents__link toc-highlight">Choosing components to regionalize</a></li><li><a href="#how-we-deploy-to-many-regions" class="table-of-contents__link toc-highlight">How we deploy to many regions</a><ul><li><a href="#staged-deployment-using-waves" class="table-of-contents__link toc-highlight">Staged deployment using Waves</a></li><li><a href="#infrastructure-as-code---cdk" class="table-of-contents__link toc-highlight">Infrastructure as Code - CDK</a></li></ul></li><li><a href="#other-considerations-around-regional-architectures" class="table-of-contents__link toc-highlight">Other considerations around regional architectures</a></li><li><a href="#conclusion" class="table-of-contents__link toc-highlight">Conclusion</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs">Guide</a></li></ul></div><div class="col footer__col"><div class="footer__title">Product</div><ul class="footer__items clean-list"><li class="footer__item"><a href="#" class="footer__link-item">Open source Elastic alternative</a></li><li class="footer__item"><a href="#" class="footer__link-item">Open source Panther alternative</a></li><li class="footer__item"><a href="#" class="footer__link-item">Open source SIEM alternative</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://discord.gg/YSYfHMbfZQ" target="_blank" rel="noopener noreferrer" class="footer__link-item">Discord<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/matanolabs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/matanolabs/matano" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/matano-logo/vector/default-monochrome-white.svg" alt="Matano" class="themedImage_ToTc themedImage--light_HNdA footer__logo" style="height:30px"><img src="/matano-logo/vector/default-monochrome-white.svg" alt="Matano" class="themedImage_ToTc themedImage--dark_i4oU footer__logo" style="height:30px"></div><div class="footer__copyright">Copyright © 2022 Matano Inc.<br><span>Matano is open source software licensed under the <a href="https://github.com/matanolabs/matano/blob/main/LICENSE">Apache License 2.0</a></span></div></div></div></footer></div>
<script src="/assets/js/runtime~main.09143151.js"></script>
<script src="/assets/js/main.4652622e.js"></script>
</body>
</html>