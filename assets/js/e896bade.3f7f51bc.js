"use strict";(self.webpackChunk_matano_website=self.webpackChunk_matano_website||[]).push([[1087],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>g});var o=n(67294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var u=o.createContext({}),l=function(e){var t=o.useContext(u),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=l(e.components);return o.createElement(u.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,u=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),p=l(n),g=a,m=p["".concat(u,".").concat(g)]||p[g]||d[g]||r;return n?o.createElement(m,i(i({ref:t},c),{},{components:n})):o.createElement(m,i({ref:t},c))}));function g(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=p;var s={};for(var u in t)hasOwnProperty.call(t,u)&&(s[u]=t[u]);s.originalType=e,s.mdxType="string"==typeof e?e:a,i[1]=s;for(var l=2;l<r;l++)i[l]=n[l];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},57862:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>u,contentTitle:()=>i,default:()=>d,frontMatter:()=>r,metadata:()=>s,toc:()=>l});var o=n(87462),a=(n(67294),n(3905));const r={title:"Ingestion",sidebar_position:2},i=void 0,s={unversionedId:"log-sources/ingestion",id:"log-sources/ingestion",title:"Ingestion",description:"You can ingest data from any log source using Matano. To ingest a log source into Matano, you can use either S3 or SQS ingestion.",source:"@site/docs/log-sources/ingestion.md",sourceDirName:"log-sources",slug:"/log-sources/ingestion",permalink:"/docs/log-sources/ingestion",draft:!1,editUrl:"https://github.com/matanolabs/matano/tree/main/website/docs/log-sources/ingestion.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{title:"Ingestion",sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Log sources",permalink:"/docs/log-sources/"},next:{title:"Transformation",permalink:"/docs/log-sources/transformation"}},u={},l=[{value:"S3 Ingestion",id:"s3-ingestion",level:2},{value:"Using the Matano provided sources bucket",id:"using-the-matano-provided-sources-bucket",level:3},{value:"Bringing your own bucket",id:"bringing-your-own-bucket",level:3},{value:"Expanding records",id:"expanding-records",level:2}],c={toc:l};function d(e){let{components:t,...n}=e;return(0,a.kt)("wrapper",(0,o.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"You can ingest data from any log source using Matano. To ingest a log source into Matano, you can use either S3 or SQS ingestion."),(0,a.kt)("h2",{id:"s3-ingestion"},"S3 Ingestion"),(0,a.kt)("p",null,"When you use S3 ingestion, Matano ingests data from your log source using an S3 bucket. You can either use a Matano provided bucket or bring your own bucket if you have existing data."),(0,a.kt)("h3",{id:"using-the-matano-provided-sources-bucket"},"Using the Matano provided sources bucket"),(0,a.kt)("p",null,"Matano creates a managed S3 bucket for you to use for S3 ingestion. You can use this bucket to ingest data into Matano."),(0,a.kt)("p",null,"To retrieve the value of the Matano sources bucket, use the ",(0,a.kt)("inlineCode",{parentName:"p"},"matano info")," command. See ",(0,a.kt)("a",{parentName:"p",href:"/docs/getting-started#retrieving-resource-values"},"Retrieving resource values"),"."),(0,a.kt)("p",null,"When sending data to the Matano provided sources bucket, upload files to the ",(0,a.kt)("inlineCode",{parentName:"p"},"/data/<log_source_name>")," prefix where ",(0,a.kt)("inlineCode",{parentName:"p"},"log_source_name")," is the name of your log source that you specified in your ",(0,a.kt)("inlineCode",{parentName:"p"},"log_source.yml")," file."),(0,a.kt)("p",null,"For example, to upload data for a log source named ",(0,a.kt)("inlineCode",{parentName:"p"},"serverlogs"),", you would upload data to the following key prefixes:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"/data/serverlogs/d007cb0d-7c00-43aa-b9a9-f7cc37e780dc.json\n/data/serverlogs/80cd10db-7760-4e34-830d-b98342dd180a.json\n")),(0,a.kt)("p",null,"If you are getting started, don't have existing data, or need your raw data to be a specific location, prefer using the Matano provided sources bucket."),(0,a.kt)("h3",{id:"bringing-your-own-bucket"},"Bringing your own bucket"),(0,a.kt)("p",null,"If you have existing data, or need to have your raw data in a specific location, you can configure Matano to ingest data from a provided S3 location."),(0,a.kt)("p",null,"In your ",(0,a.kt)("inlineCode",{parentName:"p"},"log_source.yml"),", specify the S3 Bucket and object prefix that your data is located at:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yml"},'ingest:\n  s3_source:\n    bucket_name: "my-org-logs-bucket"\n    key_prefix: "data/mypath"\n')),(0,a.kt)("p",null,"If you are bringing your own bucket, you need to ensure that you have correctly set up permissions on the bucket for Matano to be able to access it."),(0,a.kt)("h2",{id:"expanding-records"},"Expanding records"),(0,a.kt)("p",null,"When you send data to Matano, you need to communicate how Matano should split the data into individual records. Matano assumes your data is line delimited by default so if you are using a line delimited format like JSON Lines or CSV, Matano will automatically split your data and you do not need to provide any additional configuration."),(0,a.kt)("p",null,"If you data is not line delimited, you must tell Matano how to expand your data into records using a VRL expression. Provide the VRL expression under the ",(0,a.kt)("inlineCode",{parentName:"p"},"ingest.expand_records_from_payload")," key in your ",(0,a.kt)("inlineCode",{parentName:"p"},"log_source.yml"),", as follows:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-yml"},'ingest:\n  expand_records_from_payload: "parse_json!(.__raw).Records"\n')),(0,a.kt)("p",null,"Your VRL expression will receive the raw payload as ",(0,a.kt)("inlineCode",{parentName:"p"},"__raw")," and must return an array of records. "),(0,a.kt)("p",null,"For example, if your data is a JSON document with following format:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "Data": [\n        { "name": "john" }\n    ]\n}\n')),(0,a.kt)("p",null,"You would use the following VRL expression to expand your data:"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre"},"parse_json!(.__raw).Data\n")))}d.isMDXComponent=!0}}]);